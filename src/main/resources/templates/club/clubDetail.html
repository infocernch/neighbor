<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content="오이마켓"/>
    <meta name="author" content="아나바다"/>
    <title>오이마켓</title>
    <!-- Bootstrap 아이콘 가져오기-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet"/>
    <!-- Bootstrap -->
    <link href="/bootstrap-5.2.3-dist/css/bootstrap.my.css" rel="stylesheet"/>
    <!-- BootStrap 추가설정 -->
    <link href="/css/style.css" rel="stylesheet" type="text/css">
    <script th:src="@{/js/common.js}"></script>
    <script th:src="@{/js/jquery-3.6.3.min.js}" type="text/javascript"></script>
    <script th:src="@{/js/nav.js}"></script>

</head>
<body>
<!-- Nav바-->
<div th:replace="nav::nav"></div>
<div th:text="${postId}"></div>
<a th:href="@{/clubSave(postId=${postId})}">업데이트</a>
<a th:href="@{/clubRemove(postId=${postId})}">삭제</a>
<table>
<tr>
    <th>첨부파일</th>
    <td id="file" colspan="3">


    </td>
</tr>
</table>
<script>
/**
 * 데이터 조회
 * @param uri - API Request URI
 * @param params - Parameters
 * @returns json - 결과 데이터
 */
function getJson(uri, params) {

    let json = {}

    $.ajax({
        url : uri,
        type : 'get',
        dataType : 'json',
        data : params,
        async : false,
        success : function (response) {
            json = response;
        },
        error : function (request, status, error) {
            console.log(error)
        }
    })

    return json;
}


/**
 * 데이터 저장/수정/삭제
 * @param uri - API Request URI
 * @param method - API Request Method
 * @param params - Parameters
 * @returns json - 결과 데이터
 */
function callApi(uri, method, params) {

    let json = {}

     $.ajax({
        url : uri,
        type : method,
        contentType : 'application/json; charset=utf-8',
        dataType : 'json',
        data : (params) ? JSON.stringify(params) : {},
        async : false,
        success : function (response) {
            json = response;
        },
        error : function (request, status, error) {
            console.log(error)
        }
    })

    return json;
}

window.onload = () => {
    findAllFile();
}

// 전체 파일 조회
function findAllFile() {
    // 1. API 호출
    const postId = [[ ${postId}]];
    const response = getJson(`/posts/${postId}/images`);
<!--    console.log(response); // 응답확인-->
    // 2. 로직 종료
    if ( !response.length ) {
        return false;
    }

    // 3. 파일 영역 추가
    let fileHtml = '<div class="file_down"><div class="cont">';
    response.forEach(row => {
        fileHtml += `<a href="javascript:alert('준비 중입니다.');"><span class="icons"><i class="fas fa-folder-open"></i></span>${row.origName}</a><br>`;
    })
    fileHtml += '</div></div>';

    // 4. 파일 HTML 렌더링
    document.getElementById('file').innerHTML = fileHtml;
}
</script>
</body>
</html>